<style>
  input[type="number"]::-webkit-inner-spin-button,
  input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  .row {
    display: flex;

  }

  .coupon {
    border: 1px solid ;
    padding: 5px;
    display: flex;
  }

.occupy {
  background-color: grey;
  pointer-events: none
}
</style>
<div class="wrap">
  <div class="row">
    <div>商品照片</div>
    <div>商品名稱</div>
    <div>商店名稱</div>
    <div>數量</div>
    <div>單價</div>
    <div>小計</div>
    <div>處理</div>
  </div>
  <% items = (cart.items.sort_by {|item| item.product.shop_id})%>
  <% temp = items.group_by { |item| item.product.shop_id.itself} %>
  <% temp.values.each do |items|%>
    <div data-controller="shoptotal" data-shoptotal-id="<%= items[0].shop_id %>">
      <% items.each do |item| %>
        <div class="row" data-controller="updatecart" data-updatecart-id
        ="<%= item.product.id %>" data-updatecart-number-value="<%= item.quantity %>" data-updatecart-totalprice-value="0">
          <div>
            <%= link_to product_path(item.product) do %><%= image_tag item.product.image_url if item.product.image_url.present? %><% end %>
          </div>
          <div>
            <%= item.product.name %>
          </div>
          <div>
            <%= item.product.shop.name %>
          </div>
          <div>
            <div class="amount">
              <button class="minu" data-action="click->updatecart#minusbtn">-</button>
              <input type="number" class="input_amount" data-updatecart-target="amount" data-action="input->updatecart#changequantity">
              <button class="plus" data-action="click->updatecart#plusbtn">+</button>  
            </div>
          </div>
          <div data-updatecart-target="price">
            <%= item.product.price %>
          </div>
          <div class="item_total_price" data-updatecart-target="totalprice" data-shopid="<%= item.product.shop_id %>">
            <%= item.total_price %>
          </div>
          <div>
            <a href="#" data-action="click->updatecart#destroy">取消</a>
          </div>
        </div>
      <% end %>
      <div class="row">
        <div data-action="plusbtn@window->shoptotal#update changequantity@window->shoptotal#update minusbtn@window->shoptotal#update usecoupon@window->shoptotal#update unusecoupon@window->shoptotal#update">
          總金額 : 
          <span data-shoptotal-target="shoptotal" data-shopid="<%= items.first.product.shop_id %>">
          <%#= current_cart.subtotals.filter {|subtotal, shopid| shopid == items.first.shop_id}[0][0] %> 
          </span>
        </div>
      </div>
    </div>
  <% end %>
  <div class="row">
    <div>總價</div>
    <div class="cart_total">
      <%= cart.total_price %>
    </div>
  </div>
</div>